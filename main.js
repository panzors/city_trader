(()=>{var t={907:(t,e,s)=>{"use strict";s.r(e),s.d(e,{default:()=>i,getVector:()=>o});class i{constructor(t,e){this.xDir=t,this.yDir=e}add(t){return new i(this.xDir+t.xDir,this.yDir+t.yDir)}reverse(){return new i(-this.xDir,-this.yDir)}normalise(){const t=Math.sqrt(Math.pow(this.yDir,2)+Math.pow(this.xDir,2));return new i(this.xDir/t,this.yDir/t)}multiply(t){return new i(this.xDir*t,this.yDir*t)}length(){return Math.sqrt(Math.pow(this.xDir,2)+Math.pow(this.yDir,2))}}function o(t,e){return new i(e.x-t.x,e.y-t.y)}},302:(t,e,s)=>{const{default:i}=s(907);let o=null,n=null,r=null;function a(t){return{x:t.offsetX,y:t.offsetY}}t.exports={mouseDown:function(t){n=a(t),o=performance.now()},mouseUp:function(t){const e=performance.now()-o<100;return o=null,n=null,{withinClickThreshold:e}},mouseMove:function(t){r=a(t)},isItStillDown:function(){return null!=o},calculateCurrentVector:function(t){if(null!=n){const e=a(t);return new i(e.x-r.x,e.y-r.y)}},calculateCurrentVectorSinceMouseDown:function(t){if(null!=n){const e=a(t);return new i(e.x-n.x,e.y-n.y)}}}}},e={};function s(i){var o=e[i];if(void 0!==o)return o.exports;var n=e[i]={exports:{}};return t[i](n,n.exports,s),n.exports}s.d=(t,e)=>{for(var i in e)s.o(e,i)&&!s.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})},s.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),s.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},(()=>{"use strict";var t=s(302);let e=null,i=!1,o=!1,n=0,r=null;function a(){if(o){const t=performance.now(),s=1*(t-n);e+=s,r(s),n=t,setTimeout(a,10)}else setTimeout(a,10)}var u,c=new Uint8Array(16);function h(){if(!u&&!(u="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return u(c)}const l=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i,d=function(t){return"string"==typeof t&&l.test(t)};for(var p=[],m=0;m<256;++m)p.push((m+256).toString(16).substr(1));const f=function(t,e,s){var i=(t=t||{}).random||(t.rng||h)();if(i[6]=15&i[6]|64,i[8]=63&i[8]|128,e){s=s||0;for(var o=0;o<16;++o)e[s+o]=i[o];return e}return function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=(p[t[e+0]]+p[t[e+1]]+p[t[e+2]]+p[t[e+3]]+"-"+p[t[e+4]]+p[t[e+5]]+"-"+p[t[e+6]]+p[t[e+7]]+"-"+p[t[e+8]]+p[t[e+9]]+"-"+p[t[e+10]]+p[t[e+11]]+p[t[e+12]]+p[t[e+13]]+p[t[e+14]]+p[t[e+15]]).toLowerCase();if(!d(s))throw TypeError("Stringified UUID is invalid");return s}(i)};class y{constructor(t){this.id=f(),this.options=t||{},this.isMouseOver=!1,this.dragging=!1,this.path=null}get zIndex(){return 0|this.options?.zIndex}draw(t){}passTime(t){"function"==typeof this.options?.passTime&&this.options.passTime(t)}setMouseOver(t){this.isMouseOver=t}setDragging(t){this.dragging=t}isMouseInside(t,e){return!!this.path&&t.isPointInPath(this.path,e.offsetX,e.offsetY)}outputDebug(){console.log(this)}}class g extends y{constructor(t){super(t)}draw(t){"function"==typeof this.options?.modifier&&this.options.modifier(t,this),this.path=new Path2D,this.path.arc(this.options.location.x,this.options.location.y,this.options.radius,this.options.startAngle,this.options.endAngle,!1),t.fill(this.path)}nudgeLocation(t){t&&(this.options.location=this.options.location.add(t))}}class w{constructor(t,e){this.x=t,this.y=e}add(t){return new w(this.x+t.xDir,this.y+t.yDir)}}const x={};let v=null;function T(t){if(!v)throw Error("Current Scene not set, please set the scene to add asset to");!function(t,e){const s=x[t];if(!t||!s)throw Error(`something wrong with this scene ${t}`);s.addAsset(e)}(v,t)}function D(){return x[v]}const C=function(t,e){return t.zIndex>e.zIndex?-1:t.zIndex<e.zIndex?1:0},b={};function M(t){return b[t]}class k{constructor(t,e){if(!t)throw Error("no item type for this crate");if(!e)throw Error(`invalid quantity ${e}`);this.itemType=t,this.quantity=e}}class E{constructor(t,e,s){this.inputs=t,this.outputs=e,this.duration=s}}const P={wood:{name:"wood",baseValue:10,flavourText:"everyone needs some wood yo. used in construction of most products"},tools:{name:"tools",baseValue:50,flavourText:"some things can be done with tools. tools reduce time to produce products"},fineTools:{name:"fineTools",baseValue:250,flavourText:"used for higher end products"},ironOre:{name:"ironOre",baseValue:5,flavourText:"needs more work to be usable"},ironIngot:{name:"ironIngot",baseValue:30,flavourText:"used to produce a lot of other goodies"},ironWeapons:{name:"ironWeapons",baseValue:400,flavourText:"point the pointy end to people you don't like"},stone:{name:"stone",baseValue:8},food:{name:"food",baseValue:2,flavourText:"you eat this to survive, duh"}},q={wood:new E([],[new k(P.wood,1)],500),stone:new E([],[new k(P.stone,1)],500),ironIngot:new E([new k(P.ironOre,1)],[new k(P.ironIngot,1)],1e3)};class I{#stock;#options;constructor(t,e){this.#stock=t||{},this.#options=e||{}}takeAll(){const t=[];for(const[e,s]of Object.entries(this.#stock)){const i=P[e];t.push(new k(i,this.take(i,s)))}return this.#stock={},t}take(t,e){return this.hasItems(t,e)?(this.#stock[t.name]-=e,e):0}canReceive(t,e){return!0}receive(t,e){return!!this.canReceive(t,e)&&(this.#stock[t.name]||(this.#stock[t.name]=0),this.#stock[t.name]+=e,!0)}reserve(t,e){}release(t,e){}hasItems(t,e){if(!t)throw Error("item type not set");if(!e||e<0)throw Error("invalid quantity");const s=this.#stock[t.name];return!!s&&s>=e}}class A extends y{#actions=null;constructor(t,e,s,i){super({}),this.homeCity=e,this.destinationCity=s,this.#actions=t,this.completedCallback=i}passTime(t){if(0===this.#actions.length)return;const e=this.#actions[0]?.execute(t);e&&this.#actions.shift(),0===this.#actions.length&&this.completedCallback(this)}draw(t){this.#actions[0]?.draw(t)}}class S{#load=0;#actions=null;#options;constructor(t){this.route={},this.#options=t||{maxCaravanSize:20}}set cargo(t){if(t>this.#options.maxCaravanSize)throw Error("can't load this much");this.#load=t}get maxCaravanLoad(){return this.#options.maxCaravanSize}get cargo(){return this.#load}set homeCity(t){this.route.homeCity=M(t)}set destination(t){this.route.destination=M(t)}set journeyLegs(t){this.#actions=t}startJourney(t){if(!t)throw Error("hey yo, please have a callback else you wont know its done");if(!this.#actions?.length)throw Error("no actions set, that's a little odd");this.onFinishedCallback=t,this.route.homeCity&&this.route.destination||console.error(`broken journey - home city: ${this.route.homeCity} | destination city: ${this.route.desiredQuantity}`),this.journey=new A(this.#actions,this.route.homeCity,this.route.destination,(t=>this.finishJourney(t))),T(this.journey)}finishJourney(t){console.log("finished a joruney"),function(t){const e=D(),s=e.assets.findIndex((e=>e.id==t.id));s>=0&&e.assets.splice(s,1)}(this.journey),this.journey=null,this.onFinishedCallback(this,!0)}}class O extends y{constructor(t,e){super({}),this.name=t,this.worldDetails=e,this.caravans=[],this.warehouse=new I}setProfiles(t){this.consumptionProfile=t?.consumptionProfile,this.productionProfile=t?.productionProfile}get location(){return this.worldDetails.location}passTime(t){this.consumptionProfile?.passTime(t),this.productionProfile?.passTime(t)}get hunger(){return this.consumptionProfile?.hunger}addToTradeFleet(t){this.caravans.push(t)}removeFromTradeFleet(t){const e=this.caravans.findIndex((e=>e.id===t.id));this.caravans.splice(e,1)}draw(t){this.path=new Path2D,this.path.arc(this.worldDetails.location.x,this.worldDetails.location.y,25,0,2*Math.PI,!1),t.fillStyle="purple",t.fill(this.path)}}class L{#elapsedTime=0;#timeTillNextCall=0;constructor(t){this.#timeTillNextCall=t}shouldPassTime(){return!0}passTime(t){this.shouldPassTime()&&(this.#elapsedTime+=t,this.#elapsedTime>=this.#timeTillNextCall&&(this.#elapsedTime-=this.#timeTillNextCall,this.execute()))}execute(){console.log("why have you done this to me? please extend me"),console.log(this)}}class V extends L{#quantity=0;#options;#currentDemand=0;constructor(t,e,s,i){super(s),this.itemType=t,this.#quantity=e,this.#options=i||{}}get currentDemand(){return this.#currentDemand}execute(){this.#currentDemand+=this.#quantity,this.#options.maxDemand<this.#currentDemand&&this.#options.maxDemandConsequence&&this.#options.maxDemandConsequence()}quenchDemand(t){return!(this.#currentDemand-t<-10||(this.#currentDemand-=this.#quantity,0))}}class j extends L{#craftingRecipe;#warehouse;#localWarehouse;#options;constructor(t,e,s){super(e.duration),this.#warehouse=t,this.#craftingRecipe=e,this.#options=s,this.#localWarehouse=new I}shouldPassTime(){return!(this.#craftingRecipe.inputs?.length>0)||this.#craftingRecipe.inputs.map((t=>this.#warehouse.hasItems(t.itemType,t.quantity))).every((t=>!0===t))}execute(){this.#craftingRecipe.outputs.forEach((t=>{this.#localWarehouse.receive(t.itemType,t.quantity)}))}takeAllStock(){return this.#localWarehouse.takeAll()}}const R={foo:new O("foo",{location:new w(20,20)}),bar:new O("bar",{location:new w(400,300)})},z=new class extends L{#warehouse=null;#sources=[];constructor(t){super(0),this.#warehouse=t,this.#sources=[new j(this.#warehouse,q.wood)]}execute(){this.#sources.forEach((t=>{t.takeAllStock().forEach((t=>{this.#warehouse.receive(t.itemType,t.quantity)}))}))}passTime(t){super.passTime(t),this.#sources.forEach((e=>{e.passTime(t)}))}}(R.bar.warehouse);R.bar.setProfiles({productionProfile:z});const F=new class{#sinks;#warehouse;constructor(t){this.#sinks=[new V(P.wood,10,1e4)],this.#warehouse=t}passTime(t){this.#sinks.forEach((e=>{e.passTime(t)}))}get demands(){return this.#sinks.filter((t=>t.currentDemand>0)).map((t=>new k(t.itemType,t.quantity)))}quenchDemand(t){this.#sinks.find((e=>e.itemType===t.itemType)).quenchDemand(t.quantity)}};R.foo.setProfiles({consumptionProfile:F});class U{#executed=!1;#elapsedTime=0;constructor(t,e,s,i){this.caravan=t,this.itemType=s,this.targetCity=e,this.quantity=i,this.currentLocation=e.location}#canExecute(){return this.targetCity.warehouse.hasItems(this.itemType,this.quantity)}execute(t){if(!this.#canExecute())return!1;if(this.#elapsedTime+=t,this.#elapsedTime>=1e3){const t=this.targetCity.warehouse.take(this.itemType,this.quantity);return this.cargo=new k(this.itemType,t),this.caravan.cargo=this.cargo.quantity,!0}return!1}draw(t){t.fillStyle="green",t.fillRect(this.currentLocation.x,this.currentLocation.y,5,5)}}class J{constructor(t,e,s,i){this.caravan=t,this.item=s,this.quantity=i,this.targetCity=e,this.currentLocation=e.location,this.elapsedTime=0}#canExecute(){return this.targetCity.warehouse.canReceive(this.item,this.quantity)}execute(t){return!!this.#canExecute()&&(this.elapsedTime+=t,this.elapsedTime>=3e3&&(this.targetCity.warehouse.receive(this.item,this.quantity),!0))}draw(t){t.fillStyle="green",t.fillRect(this.currentLocation.x,this.currentLocation.y,5,5)}}var W=s(907);class ${#caravan=null;#direction=null;#unitsCompleted=0;#legTotalDistance=null;constructor(t,e,s){this.#caravan=t,this.destinationCity=s,this.sourceCity=e,this.currentLocation=e.location;const i=(0,W.getVector)(e.location,s.location);this.#direction=i.normalise(),this.#legTotalDistance=i.length()}execute(t){const e=20*t*.01,s=this.#direction.multiply(e),i=this.currentLocation.add(s);return this.currentLocation=i,this.#unitsCompleted+=e,this.#unitsCompleted>=this.#legTotalDistance}draw(t){t.beginPath();const e=this.sourceCity.location;t.moveTo(e.x,e.y);const s=this.destinationCity.location;t.lineTo(s.x,s.y),t.stroke(),t.fillStyle="black",t.fillRect(this.currentLocation.x,this.currentLocation.y,5,5)}}const N=[new class extends L{#fetchingProducts=[];constructor(t){super(0),this.city=t}execute(){const t=this.city.consumptionProfile.demands;t?.length&&t.forEach((t=>{if(!this.#dispatched(t.product)){const e=new S,s=Math.min(t.quantity,e.maxCaravanLoad);e.homeCity=this.city.name,this.#fetchingProducts.push(t.product),e.destination=(t.product,"bar"),this.city.addToTradeFleet(e),e.journeyLegs=function(t,e,s,i){return[new $(t,e.homeCity,e.destination),new U(t,e.destination,s,-i),new $(t,e.destination,e.homeCity),new J(t,e.homeCity,s,i)]}(e,e.route,t.product,s),e.startJourney(((e,s)=>this.onJourneyCompleted(e,s,t.product)))}}))}#dispatched(t){return!!this.#fetchingProducts.find((e=>e===t))}onJourneyCompleted(t,e,s){if(!e)throw Error("i'm not cool enough to handle failed journeys");const i=this.#fetchingProducts.findIndex((t=>t===s));this.#fetchingProducts.splice(i,1),this.city.removeFromTradeFleet(t)}}(R.foo)],X=[];const Y=document.getElementById("root");var _,B=Y.getContext("2d");void 0===x[_="default"]&&(x[_]=new class{constructor(t){this.name=t,this.assets=[],this.isMouseDown=!1,this.draggedAsset=null}addAsset(t){this.assets.push(t)}get currentMouseOverAsset(){return this.assets.find((t=>!0===t.isMouseOver))}get isDragging(){return null!==this.draggedAsset}onMouseDown(){this.isMouseDown=!0,this.draggedAsset=this.currentMouseOverAsset,this.currentMouseOverAsset&&this.currentMouseOverAsset.setDragging(!0)}onMouseUp(){this.isMouseDown=!1,this.draggedAsset&&this.draggedAsset.setDragging(!1),this.draggedAsset=null}passTime(t){this.assets.forEach((e=>e.passTime(t)))}}(_)),v=_,function(){T(new g({radius:10,startAngle:0,endAngle:2*Math.PI,location:new w(70,80),modifier:function(t,e){e.isMouseOver?t.fillStyle="green":t.fillStyle="red"},isDraggable:!0,isSnapOnDragEnd:!0,zIndex:3}));let t=0,e="black";T(new g({location:new w(75,85),radius:10,startAngle:0,endAngle:2*Math.PI,modifier:(t,s)=>{t.fillStyle=e},passTime:s=>{t+=s,e=Math.round(t/200)%2==1?"black":"purple"},isDraggable:!0,zIndex:2}))}(),function(){for(const[e,s]of Object.entries(R))b[(t=s).name]=t,T(s);var t}(),function(){for(const[e,s]of Object.entries(N))t=s,X.push(t);var t}(),Y.addEventListener("mousemove",(function(e){!function(e,s){const i=D(),o=i.assets.sort(C);let n=!1;for(let t=0;t<o.length;t++){const i=o[t];n?i.setMouseOver(!1):i.isMouseInside(e,s)?(n=!0,i.setMouseOver(!0)):i.setMouseOver(!1)}if(i.isDragging){const e=i.draggedAsset;if(e?.options?.isDraggable&&!e?.options?.isSnapOnDragEnd){const i=t.calculateCurrentVector(s);e.nudgeLocation(i)}}}(B,e),t.mouseMove(e)})),Y.addEventListener("mousedown",(function(e){D().onMouseDown(),t.mouseDown(e)})),Y.addEventListener("mouseup",(function(e){!function(e,s){const i=D(),o=i.draggedAsset;if(o?.options?.isDraggable&&o?.options?.isSnapOnDragEnd){const e=t.calculateCurrentVectorSinceMouseDown(s);o.nudgeLocation(e)}o&&o.outputDebug(),i.onMouseUp()}(0,e),t.mouseUp(e)})),Y.addEventListener("mouseout",(function(e){t.mouseUp(e)})),function(t){if(i)throw Error("hey yo, this game has already started what's going on");i=!0,e=0,r=function(t){var e;!function(t){D().passTime(t)}(t),e=t,X.forEach((t=>t.passTime(e)))},n=performance.now(),setTimeout(a,10)}(),o=!0,window.requestAnimationFrame((function t(){B.clearRect(0,0,Y.width,Y.height),function(t){D().assets.sort(C).reverse().forEach((e=>e.draw(t)))}(B),window.requestAnimationFrame(t)}))})()})();